# Системный вызов poll()

Вызов `poll()` является в System V как раз тем решением, которое обеспечивает мультиплексный ввод-вывод. Он компенсирует недостатки, имеющиеся у `select()`, хотя `select()` по-прежнему используется очень часто.

    #include <poll.h>

    int poll(struct pollfd* fds, nfds_t nfds, int timeout);

В отличие от `select()`, применяющего неэффективный метод с тремя группами дескрипторов на основе битовых масок, `poll()` работает с единым массивом структур `nfds` `pollfd`, на которые указывают файловые дескрипторы. Такая структура определяется следующим образом:

    #include <poll.h>

    struct pollfd{
        int fd, // дескриптор
        short events; // запрашиваемые события для отслеживания
        short revents; // зафиксированные возвращаемые события
    };

Допустимые события:
* `POLLIN` - имеются данные для считывания
* `POLLRDNORM` - имеются обычные данные для считывания
* `POLLRDBAND` - имеются приоритетные данные для считывания
* `POLLPRI` - имеются срочные данные для считывания
* `POLLOUT` - запись блокировать не будет
* `POLLWRNORM` - запись обычных данных блокироваться не будет
* `POOLWRBAND` - запись приоритетных данных блокировать не будет
* `POLLMSG` - доступно сообщение `SIGPOLL`

Кроме того, в поле `revents` могут быть возвращены следующие события:
* `POLLER` - возникла ошибка на указанном файловом дескрипторе
* `POLLHUP` - событие зависания на указанном файловом дескрипторе
* `POLLNVAL` - указанный файловый дескриптор не является допустимым

Параметр `timeout` вызова `poll()` указывает задержку в миллисекундах перед возвратом независимо от наличия или отсутствия готового ввода-вывода. Отрицательное значение соответствует неопределенно долгой задержке. Значение `0` предписывает вызову вернуться немедленно.

В случае успеха `poll()` возвращает количество файловых дескрипторов, чьи структуры содержат ненулевые поля `revents`. В случае истечения времени до каких-либо событий этот вызов возвратит `0`. При ошибке возвращается `-1` и устанавливается `errno`. 

**Для просветления можно прочитать про `ppoll()`**