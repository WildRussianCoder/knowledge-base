# Системные вызовы сессий

## Создание сессии

Оболочки создают новые сессии при авторизации. Они делают это с помощью специального системного вызова, который весьма упрощает создание новой сессии:

    #include <unistd.h>
    
    pid_t setsid();
    
Вызов `setsid()` создает новую сессию, предполагая, что процесс в данный момент не является лидером группы процессов. Вызывающий процесс создает лидера сессии и единственного члена новой сессии, не имеющего контролирующего `tty`. Вызов также создает новую группупроцессов внутри сессии, делая вызывающий процесс ее лидером и единственным членом. Новые идентификаторы сессии и группы процессов равны pid вызывающего процесса.

Другими словами, `setsid()` создает новую группу процессов внутри новой сессии и делает вызывающий процесс лидером того и другого. Это полезно для демонов, которые не хотят быть членами существующих сессий или иметь контролирующие терминалы, а также для оболочек, которые хотят создавать новую сессию для каждого пользователя после авторизации.

В случае успеха `setsid()` возвращает идентификатор вновь созданной сессии. В случе ошибки - `-1` и `errno`.

## Получение текущего id сессии

    #define _XOPEN_SOURCE 500
    #include <unistd.h>
    
    pid_t getsid(pid_t pid);
    
Вызов `getsid()` возвращает идентификатор сессии процесса, определенного через параметр `pid`. Если аргумент `pid` равен `0`, вызов возвращает идентификатор сессии вызывающего процесса. В случае ошибки вызов возвращает `-1` и `errno`.