# Добавление нового стража

Системный вызов `inotify_add_watch()` добавляет страж для события или событий, описанных в маске пути к файлу или каталогу. Страж добавляется для экземпляра `inotify`, которому соответствует файловый дескриптор `fd`:

    #include <sys/inotify.h>

    int inotify_add_watch(int fd, const char* path, uint32_t mask);

В случае успеха вызов возвращает дескриптор нового стража. При ошибке - `-1` и `errno`.

## Маски стражей

Маска стража является побитовым ИЛИ из одного или нескольких событий `inotify`, определяемых в файле `<inotify.h>`:
* `IN_ACCESS` - в файле выполнено считываение
* `IN_MODIFY` - файле была выполнена запись 
* `IN_ATTRIB` - метаданные были изменены
* `IN_CLOSE_WRITE` - файл был закрыт после того, как был открыт для записи
* `IN_CLOSE_NOWRITE` - файл был закрыт, но до этого не был открыт для записи
* `IN_OPEN` - файл был открыт
* `IN_MOVED_FROM` - файл был перемещен из отслеживаемого каталога
* `IN_MOVED_TO` - файл был перемещен в отслеживаемый каталог
* `IN_CREATE` - файл был создан в отслеживаемом каталоге
* `IN_DELETE` - файл был удален
* `IN_DELETE_SELF` - был удален сам отслеживаемый объект
* `IN_MOVE_SELF` - бал перемещен сам отслеживаемый объект
* `IN_ALL_EVENTS` - все допустимые события
* `IN_CLOSE` - все события связанные с закрытием
* `IN_MOVE` - все события связанные с перемещением

## События inotify

    #include <sys/inotify.h>

    struct inotify_event{
        int wd; // дескриптор стража
        uint32_t mask; // маска событий
        uint32_t cookie; // уникальное значение cookie
        uint32_t len; // размер поля `name`
        char name[]; // имя, завершаемое нулем
    };