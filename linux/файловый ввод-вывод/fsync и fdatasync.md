# fsync() и fdatasync()

Простейший метод, позволяющий гарантировать, что данные окажутся на диске, связан с использованием системного вызова `fsync()`. Этот вызов стандартизирован в POSIX.1b:

    #include <unistd.h>

    int fsync(int fd);

Вызов `fsync()` гарантирует, что все грязные данные, ассоциированные с конкретным файлом, на который отображается дескриптор fd, будут записаны на диск. В ходе отложенной записи вызов заносит на диск как данные, так и метаданные. К метаданным относятся, в частности, цифровые отметки о времени создания файла и другие атрибуты, содержащиеся в индексном дескрипторе. Вызов `fsync()` не вернется, пока жесткий диск не сообщит, что все данные и метаданные оказались на диске.

В настоящее время существуют жесткие диски с кэшами записи, поэтому вызов `fsync()` не может однозначно определить, оказались ли данные на диске физически к определенному моменту.

В Linux присутствует и системный вызов `fdatasync()`:

    #include <unistd.h>

    int fdatasync(int fd);

Этот системный вызов функционально идентичен `fsync()`, с оговоркой, что он лишь сбрасывает на диск данные и метаданные, которые потребуются для корректного доступа к файлу в будущем. Например, на диске окажется информация о размере файла, так как она необходима для верного считывания файла.

Обе функции возвращают `-1` в случае ошибки и `0` в случае успеха.