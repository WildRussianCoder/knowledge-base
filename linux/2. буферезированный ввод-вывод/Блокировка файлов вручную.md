# Блокировка файлов вручную

Функция `flockfile()` дожидается, пока не будет снята блокировка с потока данных `stream`, увеличивает количество блокировок на единицу, а потом получает блокировку и становится владеющим программным потоком этого потока данных. Затем она возвращается:

    #include <stdio.h>

    void flockfile(FILE* stream);

Функция `funlockfile()` уменьшает количество блокировок, ассоциированное с потоком данных `stream`:

    #include <stdio.h>

    void funlockfile(FILE* stream);

Если количество блокировок достигает нуля, то текущий программный поток прекращает владеть соответствующим потоком данных. Теперь блокировку сможет получить другой программный поток.

Функция `ftrylockfile()` представляет собой неблокирующую разновидность `flockfile()`:

    #include <stdio.h>

    int ftrylockfile(FILE* stream);

Если поток данных `stream` в конкретный момент заблокирован, то `ftrylockfile()` ничего не делает и сразу же возвращает ненулевое значение. Если поток данных не заблокирован в момент вызова, то функция получает блокировку, увеличивает количество блокировок, становится владеющим программным потоком потока данных `stream` и возвращает `0`.